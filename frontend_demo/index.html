<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banana App å¤šè¨€èªãƒ‡ãƒ¢</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f8f9fa; color: #333; }
        h1 { color: #f39c12; display: flex; align-items: center; justify-content: space-between; }
        
        /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #eee; }
        h2 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #f39c12; padding-bottom: 10px; display: inline-block; }
        
        /* è¨€èªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ */
        .lang-control { font-size: 1rem; padding: 5px 10px; border-radius: 5px; border: 2px solid #f39c12; background: white; }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
        select, input { padding: 10px; border-radius: 5px; border: 1px solid #ddd; width: 60%; margin-right: 10px; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #2980b9; }
        
        /* ãƒªã‚¹ãƒˆè¡¨ç¤º */
        ul { list-style: none; padding: 0; }
        li { padding: 8px 0; border-bottom: 1px solid #eee; }
        
        /* æ¤œç´¢çµæœ */
        .result-item { padding: 10px; border-bottom: 1px solid #eee; }
        .result-name { font-weight: bold; font-size: 1.1em; color: #2c3e50; }
        .result-type { color: white; background: #e74c3c; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-left: 10px; }
        .result-note { color: #7f8c8d; font-size: 0.9em; margin-top: 5px; display: block; }

        /* ã‚´ãƒŸç®± */
        .bin-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .map-link { background: #27ae60; color: white; text-decoration: none; padding: 5px 10px; border-radius: 5px; font-size: 0.9em; }
    </style>
</head>
<body>

    <h1>
        <span>ğŸŒ Banana App Demo</span>
        <select id="langSelect" class="lang-control" onchange="loadAreas()">
            <option value="ja" selected>ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (Japanese)</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="zh_cn">ğŸ‡¨ğŸ‡³ ä¸­æ–‡ (Chinese)</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´ (Korean)</option>
            <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t (Vietnamese)</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹ (Russian)</option>
            <option value="id">ğŸ‡®ğŸ‡© Bahasa Indonesia</option>
        </select>
    </h1>

    <div class="card">
        <h2>ğŸ“ 1. åœ°åŸŸ & ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« (Area & Schedule)</h2>
        <p>è¨€èªã‚’é¸ã‚“ã§ã‹ã‚‰ã‚¨ãƒªã‚¢ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
        
        <div style="display:flex; gap:10px;">
            <select id="areaSelect">
                <option value="">ã‚¨ãƒªã‚¢ã‚’èª­ã¿è¾¼ã¿ä¸­...</option>
            </select>
            <button onclick="getSchedule()">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª</button>
        </div>

        <div id="schedule-results" style="margin-top:15px;"></div>
    </div>

    <div class="card">
        <h2>ğŸ” 2. åˆ†åˆ¥è¾å…¸æ¤œç´¢ (Dictionary)</h2>
        <p>é¸ã‚“ã è¨€èªã§çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        <div style="display:flex;">
            <input type="text" id="searchInput" placeholder="Search trash (e.g. Banana)">
            <button onclick="searchTrash()">æ¤œç´¢</button>
        </div>
        <div id="search-results"></div>
    </div>

    <div class="card">
        <h2>ğŸ—‘ï¸ 3. ã‚´ãƒŸç®±ãƒ‡ãƒ¼ã‚¿ (Bins & Map)</h2>
        <button onclick="getBins()">ã‚´ãƒŸç®±ãƒªã‚¹ãƒˆã‚’å–å¾—</button>
        <div id="bin-results" style="margin-top:10px;"></div>
    </div>

    <script>
        const API_URL = "http://localhost:5000/api";

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚¨ãƒªã‚¢ä¸€è¦§ã‚’å–å¾—
        window.onload = loadAreas;

        // ==========================================
        // 1. ã‚¨ãƒªã‚¢ä¸€è¦§ã‚’å–å¾— (è¨€èªå¯¾å¿œ)
        // ==========================================
        async function loadAreas() {
            const lang = document.getElementById('langSelect').value;
            const select = document.getElementById('areaSelect');
            select.innerHTML = '<option>Loading...</option>';

            try {
                // è¨€èªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(?lang=xx)ã‚’ã¤ã‘ã¦APIã‚’å‘¼ã¶
                const res = await fetch(`${API_URL}/areas?lang=${lang}`);
                const areas = await res.json();

                select.innerHTML = '';
                areas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area.id;
                    option.textContent = area.name; // ã‚µãƒ¼ãƒãƒ¼å´ã§ç¿»è¨³ã•ã‚ŒãŸåå‰ãŒå…¥ã‚‹
                    select.appendChild(option);
                });
            } catch (err) {
                select.innerHTML = '<option>ã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“</option>';
                console.error(err);
            }
        }

        // ==========================================
        // 2. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å–å¾—
        // ==========================================
        async function getSchedule() {
            const areaId = document.getElementById('areaSelect').value;
            const resultDiv = document.getElementById('schedule-results');
            
            if (!areaId) {
                alert("ã‚¨ãƒªã‚¢ã‚’é¸æŠã—ã¦ãã ã•ã„");
                return;
            }

            try {
                const res = await fetch(`${API_URL}/schedules?area_id=${areaId}`);
                const data = await res.json();

                if (data.length === 0) {
                    resultDiv.innerHTML = "<p>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
                    return;
                }

                // è¡¨ç¤ºä½œæˆ
                let html = `<h3>ğŸ“… ä»Šå¾Œã®åé›†æ—¥</h3><ul>`;
                // ç›´è¿‘5ä»¶ã ã‘è¡¨ç¤º
                data.slice(0, 5).forEach(sch => {
                    html += `
                        <li style="border-left: 5px solid ${sch.trash_type.color}; padding-left: 10px;">
                            <strong>${sch.date}</strong> : 
                            ${sch.trash_type.name} 
                        </li>`;
                });
                html += "</ul>";
                resultDiv.innerHTML = html;

            } catch (err) {
                alert("ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼");
            }
        }

        // ==========================================
        // 3. ã‚´ãƒŸåˆ†åˆ¥æ¤œç´¢ (è¨€èªå¯¾å¿œ)
        // ==========================================
        async function searchTrash() {
            const keyword = document.getElementById('searchInput').value;
            const lang = document.getElementById('langSelect').value;
            const resultDiv = document.getElementById('search-results');

            if (!keyword) return;

            resultDiv.innerHTML = "<p>æ¤œç´¢ä¸­...</p>";

            try {
                // è¨€èªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿(?lang=xx)ã‚’ã¤ã‘ã¦APIã‚’å‘¼ã¶
                const res = await fetch(`${API_URL}/trash_search?q=${keyword}&lang=${lang}`);
                const data = await res.json();

                if (data.length === 0) {
                    resultDiv.innerHTML = "<p>è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ (Not found)ã€‚<br>â€»ä»Šã¯æ—¥æœ¬èªåã§ã®æ¤œç´¢ã®ã¿ãƒ’ãƒƒãƒˆã—ã¾ã™(APIã®ä»•æ§˜)</p>";
                    return;
                }

                resultDiv.innerHTML = `<p>${data.length} ä»¶ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸ</p>`;
                
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.innerHTML = `
                        <div>
                            <span class="result-name">${item.name}</span>
                            <span class="result-type">${item.trash_type_name}</span>
                        </div>
                        <small class="result-note">${item.note || 'No notes'}</small>
                        <small>ğŸ’° ${item.fee}</small>
                    `;
                    resultDiv.appendChild(div);
                });

            } catch (err) {
                resultDiv.innerHTML = "<p>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>";
            }
        }

        // ==========================================
        // 4. ã‚´ãƒŸç®±ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿å–å¾—
        // ==========================================
        async function getBins() {
            const resultDiv = document.getElementById('bin-results');
            resultDiv.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";

            try {
                const res = await fetch(`${API_URL}/bins`);
                const data = await res.json();

                resultDiv.innerHTML = `<p>ğŸ“ ${data.length} ç®‡æ‰€ã®å›åãƒœãƒƒã‚¯ã‚¹ãŒã‚ã‚Šã¾ã™</p>`;
                
                // æœ€åˆã®10ä»¶ã‚’è¡¨ç¤º
                data.slice(0, 10).forEach(bin => {
                    // Google Mapsã¸ã®ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
                    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${bin.lat},${bin.lon}`;
                    
                    const div = document.createElement('div');
                    div.className = 'bin-item';
                    div.innerHTML = `
                        <div>
                            <strong>${bin.name}</strong><br>
                            <small>${bin.type}</small>
                        </div>
                        <a href="${mapUrl}" target="_blank" class="map-link">Google Maps â†—</a>
                    `;
                    resultDiv.appendChild(div);
                });

            } catch (err) {
                resultDiv.innerHTML = "å–å¾—ã‚¨ãƒ©ãƒ¼";
            }
        }
    </script>
</body>
</html>